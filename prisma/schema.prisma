generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

// Authentication Models - Core for production
model User {
  id            String    @id @default(cuid())
  email         String    @unique
  password      String
  name          String?
  role          String    @default("user") // user, admin
  isActive      Boolean   @default(true)
  createdAt     DateTime  @default(now())
  updatedAt     DateTime  @updatedAt
  lastLoginAt   DateTime?

  sessions      Session[]

  @@map("users")
}

model Session {
  id           String   @id @default(cuid())
  sessionToken String   @unique
  userId       String
  expires      DateTime
  user         User     @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@map("sessions")
}

// Email Subscribers - For newsletter/updates
model EmailSubscriber {
  id           Int      @id @default(autoincrement())
  email        String   @unique
  source       String?
  subscribedAt DateTime @default(now())
  isActive     Boolean  @default(true)

  @@map("email_subscribers")
}

// Contact Submissions - For contact form
model ContactSubmission {
  id        String   @id @default(cuid())
  name      String
  email     String
  phone     String?
  message   String
  status    String   @default("new") // new, read, responded
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@index([email])
  @@index([createdAt])
  @@map("contact_submissions")
}

// Survey Models - For Data Initiative
model SurveySubmission {
  id            String   @id @default(cuid())
  surveyType    String   // 'individual' or 'business'
  responses     Json     // Survey question responses including qualitative answers

  // User Authentication & Basic Info
  userEmail     String   // User's login email
  userPassword  String   // Hashed password for survey access
  contactName   String
  contactEmail  String   // Can be different from userEmail
  phoneNumber   String
  stripeEmail   String
  country       String
  ageConfirmed  Boolean  @default(false)

  // Banking Information for Individual Surveys
  bankAccount   String?  // Bank account number
  bankName      String?  // Bank name

  // Business Registration (for Business Surveys)
  businessName         String?
  businessRegNumber    String?  // Business registration number
  businessEmail        String?  // Official business email
  businessPhone        String?  // Business phone number
  businessAddress      String?  // Business address
  businessType         String?  // Type of business (e.g., Tech, Manufacturing, etc.)

  // System Fields
  ipAddress     String?
  userAgent     String?
  status        String   @default("submitted") // submitted, processed, paid, failed
  rewardAmount  Decimal  @default(0.00)
  paymentStatus String   @default("pending") // pending, sent, failed, completed
  paymentId     String?  // Stripe payment ID
  submittedAt   DateTime @default(now())
  processedAt   DateTime?
  paidAt        DateTime?

  @@index([userEmail])
  @@index([contactEmail])
  @@index([stripeEmail])
  @@index([surveyType])
  @@index([status])
  @@index([paymentStatus])
  @@index([submittedAt])
  @@index([businessRegNumber])
  @@map("survey_submissions")
}

// Survey Analytics - Track participation and completion rates
model SurveyAnalytics {
  id              String   @id @default(cuid())
  surveyType      String
  questionId      String
  selectedOption  String
  participantId   String   // Reference to SurveySubmission.id
  country         String?
  timestamp       DateTime @default(now())

  @@index([surveyType])
  @@index([questionId])
  @@index([country])
  @@index([timestamp])
  @@map("survey_analytics")
}

// Payment Logs - Track all payment attempts and status
model PaymentLog {
  id              String   @id @default(cuid())
  surveyId        String   // Reference to SurveySubmission.id
  stripeEmail     String
  amount          Decimal
  currency        String   @default("USD")
  status          String   // pending, sent, failed, completed
  stripePaymentId String?
  errorMessage    String?
  attemptCount    Int      @default(1)
  createdAt       DateTime @default(now())
  updatedAt       DateTime @updatedAt

  @@index([surveyId])
  @@index([stripeEmail])
  @@index([status])
  @@index([createdAt])
  @@map("payment_logs")
}